import{open as ee}from"node:fs/promises";import{join as te}from"node:path";var ne={arrowParens:"arrow-parens",bracketSpacing:"block-spacing",endOfLine:"linebreak-style",quoteProps:"quote-props",semi:"semi",singleQuote:"quotes",trailingComma:"comma-dangle"},re=new Set(["block-spacing","comma-dangle","quotes","quote-props"]),ie={printWidth:"code",tabWidth:"tabWidth"},oe=new Set(["printWidth","tabWidth"]),se=new Set(["avoid","false","none","preserve"]),ae=new Set(["plugins","bracketSameLine","parser","editorconfig","embeddedLanguageFormatting","experimentalTernaries","jsxBracketSameLine","jsxSingleQuote","singleAttributePerLine","useTabs","vueIndentScriptAndStyle","htmlWhitespaceSensitivity","proseWrap","insertPragma","requirePragma","filepath","rangeStart","rangeEnd"]),V="@stylistic/js",le="@stylistic/ts",D=`${V}/max-len`;function fe(e,t,n){let r=e[D];r||(r=e[D]=[2,{}]),r[1][ie[t]]=n}function ce(e,t,n,r){switch(n){case"semi":e["@stylistic/ts/member-delimiter-style"]=[2,{multiline:{delimiter:r?"none":"semi"},singleline:{delimiter:"semi",requireLast:!1}}];break}}function pe(e,t,n){typeof n=="boolean"&&(n=`${n}`);let r=se.has(n),i=ne[t],o=re.has(i)?le:V,s=0;switch(i){case"block-spacing":s=[2,r?"never":"always"],e[`${o}/object-curly-spacing`]=s;break;case"arrow-parens":case"quote-props":s=r?0:[2,n];break;case"semi":s=[2,r?"never":"always"];break;case"quotes":s=[2,r?"double":"single",{avoidEscape:!0}];break;case"comma-dangle":s=r?[2,"never"]:[2,n==="all"?"always":"only-multiline"];break;case"linebreak-style":s=[2,n==="lf"?"unix":"windows"];break;default:throw new Error(`Unknown prettier option ${t}.`)}e[`${o}/${i}`]=s,ce(e,o,i,r)}async function C(e){let t,n={};try{t=await ee(te(e.root,".prettierrc"),"r")}catch{return{name:"prettier-apply",rules:[]}}let r=JSON.parse((await t.readFile()).toString());for(let i of Object.keys(r))ae.has(i)||(oe.has(i)?fe(n,i,r[i]):pe(n,i,r[i]));return await t.close(),{name:"prettier-apply",rules:[n]}}import{fdir as ge}from"fdir";async function w(e){let n=await new ge().withFullPaths().withMaxDepth(1).crawl(e.root).withPromise(),r=n.length,i=[],o;for(let s=0;s<r;s++)o=n[s],o.includes("tsconfig")&&o.includes("json")&&i.push(o);return{name:"tsconfig-resolve",languageOptions:{parserOptions:{project:i}}}}import{open as ue}from"node:fs/promises";import{join as me}from"node:path";async function L(e,t){let n,r=[];try{n=await ue(me(e,t),"r")}catch{return{ignores:r,name:`parse-${t}`}}for await(let i of n.readLines())!i.length||i[0]==="#"||(i[0]==="*"&&i[1]==="."?r.push(i,`**/${i}`):r.push(i,i[0]==="!"||i[0]==="/"?`${i}/**`:`**/${i}/**`));return await n.close(),{ignores:[...new Set(r)],name:`parse-${t}`}}import{dirname as be}from"node:path";import{fileURLToPath as xe}from"node:url";var de=new Set(["angular","web","cypress","format","fp","jest","json","node","react","base","test-base","test-angular","test-web","test-react","test-vue","tsdoc","vitest","vue"]);function O(e){return de.has(e)}function c(e){return e?Array.isArray(e)?e.slice():[e]:[]}function g(e,t){return Array.prototype.push.apply(e,t),e}function u(e){for(let t in e)return!1;return!0}function ye(e,t){return[...new Set((e??[]).slice().concat(t??[]))]}function S(e,t,n,r=[]){let i=[...new Set(Object.keys(e??[]).concat(Object.keys(t)??[]))],o,s,l;for(let a of i)r.includes(a)||(n.includes(a)?e[a]=t[a]??e[a]:(o=e[a],s=t[a],Array.isArray(o)?l=ye(o,s):typeof o=="object"&&o!==null?l=Object.assign({},o,s):l=s??o,e[a]=l))}function Pe(e,t){if(!t.languageOptions){e.languageOptions??={};return}let n=t.languageOptions,r=e.languageOptions??={};S(r,n,["parser"],["parserOptions"]);let i=n.parserOptions;if(!i){r.parserOptions??={};return}r.parserOptions?S(r.parserOptions,i,["parser"]):r.parserOptions=i}function he(e){let t=Object.keys(e);for(let n of t)(Array.isArray(e[n])&&!e[n].length||u(e[n]))&&delete e[n]}function d(e,t){let n=Object.assign({},e);return Pe(n,t),S(n,t,["name"],["extends","languageOptions"]),he(n),n}var x=new Map;async function _(e){if(x.has(e))return x.get(e);let t=await import(`file://${be(xe(import.meta.url))}/profiles/${e}.js`);return x.set(e,t.config),t.default??t.config}function Ce(e){let t={};return e.parserOptions?t={parserOptions:e.parserOptions}:e.languageOptions&&(t=e.languageOptions,t.globals=c(e.languageOptions.globals)),{files:e.files,ignores:e.ignores,languageOptions:t,linterOptions:e.linterOptions,name:"extended-file",plugins:e.plugins??{},processor:c(e.processor),rules:c(e.rules),settings:e.settings}}async function we(e,t){let n;if(typeof e=="string"&&O(e))if(x.has(e))n=x.get(e);else{let r=await _(e);Array.isArray(r)?(n=r.shift(),g(t,r)):n=r}else typeof e!="string"&&(n=Ce(e));return n}async function B(e,t){if(!e.extends)return e;let n=e.extends.length,r=e,i;for(let o=0;o<n;o++)i=await we(e.extends[o],t),i&&(i.extends&&(i=await B(i,t)),r=d(i,r),i=void 0);return r}async function Le(e){if(!e.length)return[];let t=[];for(let n=0;n<e.length;n++)t.push(await B(e[n],e));return t}async function R(e){let t=e.configs,n=t.length,r=new Array(n);for(let o=0;o<n;o++)r[o]=_(t[o]);let i=await Promise.all(r);return Le(i.flat())}function k(e,t){let n=t.length;if(!n||!e.length)return e.slice();let r;for(let i=0;i<n;i++)if(r=e.indexOf(t[i]),r>-1&&e.splice(r,1),!e.length)return[];return e.slice()}var Oe=["brace-style","no-extra-parens","object-curly-spacing","quote-props"];var I=[...Oe,"arrow-parens","indent","semi","quotes","lines-around-comment","padding-line-between-statements","space-before-function-paren"],N=["class-methods-use-this","consistent-return","dot-notation","default-param-last","no-array-constructor","no-loop-func","no-loss-of-precision","no-redeclare","no-throw-literal","no-unused-vars","no-unused-expressions","no-use-before-define","no-useless-constructor","require-await"],j=["comma-spacing","func-call-spacing","key-spacing","keyword-spacing","lines-between-class-members","no-extra-semi","space-before-blocks","space-infix-ops"],H=["type-annotation-spacing"],ct=[...k(j,["lines-between-class-members","no-extra-semi","space-before-blocks"]),"block-spacing","func-call-spacing"],J=["arrow-spacing","eol-last","no-trailing-spaces","space-in-parens"];function m(...e){return Object.assign({},...e)}var y="?([cm])[jt]s?(x)";var U=`**/*${y}`,ut=[`**/__tests__/**/*.${y}`,`**/*.spec.${y}`,`**/*.test.${y}`,`**/*.bench.${y}`,`**/*.benchmark.${y}`];function v(e){return!!e.configs.recommended}function F(e){let t=Object.keys(e),n=t.length,r={plugins:{},rules:{}},i,o;for(let s=0;s<n;s++)i=t[s],o=e[i],r.plugins[i]=o,v(o)&&(r.rules=Object.assign(r.rules,o.configs.recommended.rules));return r}function P(e,t){return e==="eslint"?t:`${e}/${t}`}function T(e,t){let n=e.length,r=t.length,i={},o,s;for(let l=0;l<r;l++)for(o=t[l],s=0;s<n;s++)i[P(o,e[s])]=0;return i}function h(e,t,n){let r=e.length,i=t.length,o=n.length,s={},l,a;for(let f=0;f<r;f++){for(l=e[f],a=0;a<i;a++)s[P(t[a],l)]=0;for(a=0;a<o;a++)s[P(n[a],l)]=2}return s}function A(e){let t=new Map,n=e.length,r=`merged-processor:${e[0].meta?.name??"unknown"}`;for(let i=1;i<n;i++)r=`${r}+${e[i].meta?.name??"unknown"}`;return{meta:{name:r},postprocess(i,o){let s=t.get(o),l=[];t.delete(o);let a=0,f;for(let b=0;b<n;b++)f=i.slice(a,a+s[b]),a+=s[b],g(l,e[b].postprocess?.(f,o)??[]);return l},preprocess(i,o){let s=new Array(n),l=[];t.set(o,s);let a;for(let f=0;f<n;f++)a=e[f].preprocess?.(i,o)??[],s[f]=a.length,g(l,a);return l},supportsAutofix:!0}}function Se(e){let t=e.languageOptions;if(!t||u(t))return!0;if(t.parserOptions){let n=t.parserOptions;return u(n)?!0:n.project&&!n.project.length}return!!t.globals&&u(t.globals)}function Re(){return[T(I,["eslint","@typescript-eslint","@stylistic/ts"]),h(N,["eslint"],["@typescript-eslint"]),h(j,["eslint","@typescript-eslint"],["@stylistic/ts"]),h(J,["eslint"],["@stylistic/js"]),h(H,["@typescript-eslint"],["@stylistic/ts"])]}function z(e,t,n,r,i,o){let s=t[r];s?.length?e[r]=s:i?e[r]=n[0][r]??o:e[r]=o}function ke(e,t){let n=e.length;if(!n)return-1;let r;for(let i=0;i<n;i++)if(r=t.indexOf("/"),r>=0&&e[i].startsWith(t.substring(0,r)))return i;return-1}function Q(e,t){if(!e)return;let n=Object.keys(t),r=e.length,i,o,s;for(let l=0;l<r;l++){o=e[l].rules??e[l],s={};for(let a in o)i=ke(n,a),i>=0?s[a.replace(n[i],t[n[i]])]=o[a]:s[a]=o[a];e[l]=Object.assign({},s)}}var je=[U],ve=[];function E(e,t,n){let r=t.length,i=new Array(r),o,s,l;for(let a=0;a<r;a++){if(o=t[a],s=o.apply?F(o.apply):{},z(s,o,t,"files",n,je),z(s,o,t,"ignores",n,ve),o.languageOptions&&(l=s.languageOptions=o.languageOptions,l.globals=m(...c(o.languageOptions.globals))),Se(s)&&delete s.languageOptions,o.linterOptions&&(s.linterOptions=o.linterOptions),o.settings&&(s.settings=o.settings),o.processor&&(s.processor=A(o.processor)),s.plugins=m(s.plugins??{},o.plugins??{}),e.rename&&Q(o.rules??[],e.rename),s.rules=m(s.rules??{},...o.rules??[]),n&&a===0){let f=Re();Q(f,e.rename),s.rules=m(s.rules,...f),s.languageOptions.parserOptions.tsconfigRootDir=e.root}i[a]=s}return i}var Fe=new Set(["base","fp","react","vue","angular","node","test-base","test-angular","test-react","test-vue","test-web"]);function $(e){let t=!1;for(let n=e.configs.length-1;n>=0;n--)if(Fe.has(e.configs[n])){t=!0;break}return t}import{existsSync as K}from"node:fs";import{mkdir as Te,open as Ae,writeFile as Ee}from"node:fs/promises";import{join as X}from"node:path";var q={"editor.codeActionsOnSave":{"source.fixAll.eslint":"explicit"},"eslint.experimental.useFlatConfig":!0,"eslint.rules.customizations":[{rule:"style/*",severity:"off"},{rule:"format/*",severity:"off"},{rule:"*-indent",severity:"off"},{rule:"*-spacing",severity:"off"},{rule:"*-spaces",severity:"off"},{rule:"*-order",severity:"off"},{rule:"*-dangle",severity:"off"},{rule:"*-newline",severity:"off"},{rule:"*quotes",severity:"off"},{rule:"*semi",severity:"off"}],"eslint.validate":["javascript","javascriptreact","typescript","typescriptreact","vue","html","markdown","json","jsonc","yaml","toml","astro"]},$e=Object.keys(q);async function G(e){let t=X(e.root,".vscode"),n=X(t,"settings.json");K(t)||await Te(t),K(n)||await Ee(n,JSON.stringify(q),"utf8");let r=await Ae(n,"r+"),i=JSON.parse((await r.readFile()).toString()),o=!0;for(let s of $e)if(i[s]){o=!1;break}o&&await r.writeFile(JSON.stringify(Object.assign(i,q))),await r.close()}import qe from"ora";import*as p from"yoctocolors";var M=[p.yellow("Fetching configs..."),p.cyan("Applying plugins..."),p.blueBright("Parsing profiles...")],Y=["yellow","cyan","blue"];function*W(){let e=Date.now(),t=qe(M[0]);t.color=Y[0],t.start(),yield;let n=M.length,r;for(r=1;r<n;r++)t.succeed(),t.color=Y[r],t.text=M[r],t.start(),yield;t.color="green",t.text=p.greenBright(`Ready to lint after ${Date.now()-e}ms!`),t.succeed()}var Z={configs:["base"],ignoreFiles:[".eslintignore, .gitignore"],patchVSCode:!0,prettier:!0,rename:{"@typescript-eslint":"ts","@microsoft/sdl":"sdl"},root:process.cwd()};async function Ge(e){let t=Object.assign({},Z,e);if(t.rename=Object.assign({},Z.rename,e.rename??{}),!t.configs.length)return[];let n=W();n.next();let r=$(t),i=[R(t),w(t)];if(r&&t.prettier&&i.push(C(t)),t.ignoreFiles.length)for(let a=t.ignoreFiles.length-1;a>=0;a--)i.push(L(t.root,t.ignoreFiles[a]));t.patchVSCode&&i.push(G(t));let o=await Promise.all(i);n.next();let s=o.shift();s.unshift(d(s.shift(),...c(o))),n.next();let l=E(t,s,r);return n.next(),l}export{Ge as default,m as merge,g as mergeArr};
