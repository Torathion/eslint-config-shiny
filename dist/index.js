import{open as ee}from"node:fs/promises";var p=process.cwd();var te={arrowParens:"arrow-parens",bracketSpacing:"block-spacing",endOfLine:"linebreak-style",quoteProps:"quote-props",semi:"semi",singleQuote:"quotes",trailingComma:"comma-dangle"},ne=new Set(["block-spacing","comma-dangle","quotes","quote-props"]),re={printWidth:"code",tabWidth:"tabWidth"},ie=new Set(["printWidth","tabWidth"]),se=new Set(["avoid","false","none","preserve"]),oe=new Set(["plugins","bracketSameLine","parser","editorconfig","embeddedLanguageFormatting","experimentalTernaries","jsxBracketSameLine","jsxSingleQuote","singleAttributePerLine","useTabs","vueIndentScriptAndStyle","htmlWhitespaceSensitivity","proseWrap","insertPragma","requirePragma","filepath","rangeStart","rangeEnd"]),B="@stylistic/js",ae="@stylistic/ts",_=`${B}/max-len`;function le(e,t,n){let r=e[_];r||(r=e[_]=[2,{}]),r[1][re[t]]=n}function fe(e,t,n,r){switch(n){case"semi":e["@stylistic/ts/member-delimiter-style"]=[2,{multiline:{delimiter:r?"none":"semi"},singleline:{delimiter:"semi",requireLast:!1}}];break}}function ce(e,t,n){typeof n=="boolean"&&(n=`${n}`);let r=se.has(n),s=te[t],i=ne.has(s)?ae:B,o=0;switch(s){case"block-spacing":o=[2,r?"never":"always"],e[`${i}/object-curly-spacing`]=o;break;case"arrow-parens":case"quote-props":o=r?0:[2,n];break;case"semi":o=[2,r?"never":"always"];break;case"quotes":o=[2,r?"double":"single",{avoidEscape:!0}];break;case"comma-dangle":o=r?[2,"never"]:[2,n==="all"?"always":"only-multiline"];break;case"linebreak-style":o=[2,n==="lf"?"unix":"windows"];break;default:throw new Error(`Unknown prettier option ${t}.`)}e[`${i}/${s}`]=o,fe(e,i,s,r)}async function C(){let e,t={};try{e=await ee(`${p}/.prettierrc`,"r")}catch{return{name:"prettier-apply",rules:[]}}let n=JSON.parse((await e.readFile()).toString());for(let r of Object.keys(n))oe.has(r)||(ie.has(r)?le(t,r,n[r]):ce(t,r,n[r]));return await e.close(),{name:"prettier-apply",rules:[t]}}import{fdir as pe}from"fdir";async function L(){let t=await new pe().withFullPaths().withMaxDepth(1).crawl(p).withPromise(),n=t.length,r=[],s;for(let i=0;i<n;i++)s=t[i],s.includes("tsconfig")&&s.includes("json")&&r.push(s);return{languageOptions:{parserOptions:{project:r}}}}import{open as ge}from"node:fs/promises";async function O(e){let t,n=[];try{t=await ge(`${p}/${e}`,"r")}catch{return{ignores:n,name:`parse-${e}`}}for await(let r of t.readLines())!r.length||r[0]==="#"||(r[0]==="*"&&r[1]==="."?n.push(r,`**/${r}`):n.push(r,r[0]==="!"||r[0]==="/"?`${r}/**`:`**/${r}/**`));return await t.close(),{ignores:[...new Set(n)],name:`parse-${e}`}}import{dirname as Pe}from"node:path";import{fileURLToPath as be}from"node:url";var ue=new Set(["angular","web","cypress","format","fp","jest","json","node","react","base","test-base","test-angular","test-web","test-react","test-vue","tsdoc","vitest","vue"]);function S(e){return ue.has(e)}function c(e){return e?Array.isArray(e)?e.slice():[e]:[]}function u(e,t){return Array.prototype.push.apply(e,t),e}function m(e){for(let t in e)return!1;return!0}function me(e,t){return[...new Set((e??[]).slice().concat(t??[]))]}function k(e,t,n,r=[]){let s=[...new Set(Object.keys(e??[]).concat(Object.keys(t)??[]))],i,o,l;for(let a of s)r.includes(a)||(n.includes(a)?e[a]=t[a]??e[a]:(i=e[a],o=t[a],Array.isArray(i)?l=me(i,o):typeof i=="object"&&i!==null?l=Object.assign({},i,o):l=o??i,e[a]=l))}function de(e,t){if(!t.languageOptions){e.languageOptions??={};return}let n=t.languageOptions,r=e.languageOptions??={};k(r,n,["parser"],["parserOptions"]);let s=n.parserOptions;if(!s){r.parserOptions??={};return}r.parserOptions?k(r.parserOptions,s,["parser"]):r.parserOptions=s}function ye(e){let t=Object.keys(e);for(let n of t)(Array.isArray(e[n])&&!e[n].length||m(e[n]))&&delete e[n]}function y(e,t){let n=Object.assign({},e);return de(n,t),k(n,t,["name"],["extends","languageOptions"]),ye(n),n}var w=new Map;async function D(e){if(w.has(e))return w.get(e);let t=await import(`file://${Pe(be(import.meta.url))}/profiles/${e}.js`);return w.set(e,t.config),t.default??t.config}function he(e){let t={};return e.parserOptions?t={parserOptions:e.parserOptions}:e.languageOptions&&(t=e.languageOptions,t.globals=c(e.languageOptions.globals)),{files:e.files,ignores:e.ignores,languageOptions:t,linterOptions:e.linterOptions,name:"extended-file",plugins:e.plugins??{},processor:c(e.processor),rules:c(e.rules),settings:e.settings}}async function xe(e,t){let n;if(typeof e=="string"&&S(e))if(w.has(e))n=w.get(e);else{let r=await D(e);Array.isArray(r)?(n=r.shift(),u(t,r)):n=r}else typeof e!="string"&&(n=he(e));return n}async function I(e,t){if(!e.extends)return e;let n=e.extends.length,r=e,s;for(let i=0;i<n;i++)s=await xe(e.extends[i],t),s&&(s.extends&&(s=await I(s,t)),r=y(s,r),s=void 0);return r}async function we(e){if(!e.length)return[];let t=[];for(let n=0;n<e.length;n++)t.push(await I(e[n],e));return t}async function R(e){let t=e.configs,n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=D(t[i]);let s=await Promise.all(r);return we(s.flat())}function j(e,t){let n=t.length;if(!n||!e.length)return e.slice();let r;for(let s=0;s<n;s++)if(r=e.indexOf(t[s]),r>-1&&e.splice(r,1),!e.length)return[];return e.slice()}var Ce=["brace-style","no-extra-parens","object-curly-spacing","quote-props"];var N=[...Ce,"arrow-parens","indent","semi","quotes","lines-around-comment","padding-line-between-statements","space-before-function-paren"],H=["class-methods-use-this","consistent-return","dot-notation","default-param-last","no-array-constructor","no-loop-func","no-loss-of-precision","no-redeclare","no-throw-literal","no-unused-vars","no-unused-expressions","no-use-before-define","no-useless-constructor","require-await"],v=["comma-spacing","func-call-spacing","key-spacing","keyword-spacing","lines-between-class-members","no-extra-semi","space-before-blocks","space-infix-ops"],J=["type-annotation-spacing"],ct=[...j(v,["lines-between-class-members","no-extra-semi","space-before-blocks"]),"block-spacing","func-call-spacing"],U=["arrow-spacing","eol-last","no-trailing-spaces","space-in-parens"];function d(...e){return Object.assign({},...e)}var P="?([cm])[jt]s?(x)";var z=`**/*${P}`,ut=[`**/__tests__/**/*.${P}`,`**/*.spec.${P}`,`**/*.test.${P}`,`**/*.bench.${P}`,`**/*.benchmark.${P}`];function F(e){return!!e.configs.recommended}function T(e){let t=Object.keys(e),n=t.length,r={plugins:{},rules:{}},s,i;for(let o=0;o<n;o++)s=t[o],i=e[s],r.plugins[s]=i,F(i)&&(r.rules=Object.assign(r.rules,i.configs.recommended.rules));return r}function b(e,t){return e==="eslint"?t:`${e}/${t}`}function $(e,t){let n=e.length,r=t.length,s={},i,o;for(let l=0;l<r;l++)for(i=t[l],o=0;o<n;o++)s[b(i,e[o])]=0;return s}function h(e,t,n){let r=e.length,s=t.length,i=n.length,o={},l,a;for(let f=0;f<r;f++){for(l=e[f],a=0;a<s;a++)o[b(t[a],l)]=0;for(a=0;a<i;a++)o[b(n[a],l)]=2}return o}function A(e){let t=new Map,n=e.length,r=`merged-processor:${e[0].meta?.name??"unknown"}`;for(let s=1;s<n;s++)r=`${r}+${e[s].meta?.name??"unknown"}`;return{meta:{name:r},postprocess(s,i){let o=t.get(i),l=[];t.delete(i);let a=0,f;for(let x=0;x<n;x++)f=s.slice(a,a+o[x]),a+=o[x],u(l,e[x].postprocess?.(f,i)??[]);return l},preprocess(s,i){let o=new Array(n),l=[];t.set(i,o);let a;for(let f=0;f<n;f++)a=e[f].preprocess?.(s,i)??[],o[f]=a.length,u(l,a);return l},supportsAutofix:!0}}function Le(e){let t=e.languageOptions;if(!t||m(t))return!0;if(t.parserOptions){let n=t.parserOptions;return m(n)?!0:n.project&&!n.project.length}return!!t.globals&&m(t.globals)}function Oe(){return[$(N,["eslint","@typescript-eslint","@stylistic/ts"]),h(H,["eslint"],["@typescript-eslint"]),h(v,["eslint","@typescript-eslint"],["@stylistic/ts"]),h(U,["eslint"],["@stylistic/js"]),h(J,["@typescript-eslint"],["@stylistic/ts"])]}function Q(e,t,n,r,s,i){let o=t[r];o?.length?e[r]=o:s?e[r]=n[0][r]??i:e[r]=i}function Se(e,t){let n=e.length;if(!n)return-1;let r;for(let s=0;s<n;s++)if(r=t.indexOf("/"),r>=0&&e[s].startsWith(t.substring(0,r)))return s;return-1}function K(e,t){if(!e)return;let n=Object.keys(t),r=e.length,s,i,o;for(let l=0;l<r;l++){i=e[l].rules??e[l],o={};for(let a in i)s=Se(n,a),s>=0?o[a.replace(n[s],t[n[s]])]=i[a]:o[a]=i[a];e[l]=Object.assign({},o)}}var ke=[z],Re=[];function E(e,t,n){let r=t.length,s=new Array(r),i,o,l;for(let a=0;a<r;a++){if(i=t[a],o=i.apply?T(i.apply):{},Q(o,i,t,"files",n,ke),Q(o,i,t,"ignores",n,Re),i.languageOptions&&(l=o.languageOptions=i.languageOptions,l.globals=d(...c(i.languageOptions.globals))),Le(o)&&delete o.languageOptions,i.linterOptions&&(o.linterOptions=i.linterOptions),i.settings&&(o.settings=i.settings),i.processor&&(o.processor=A(i.processor)),o.plugins=d(o.plugins??{},i.plugins??{}),e.rename&&K(i.rules??[],e.rename),o.rules=d(o.rules??{},...i.rules??[]),n&&a===0){let f=Oe();K(f,e.rename),o.rules=d(o.rules,...f)}s[a]=o}return s}var je=new Set(["base","fp","react","vue","angular","node","test-base","test-angular","test-react","test-vue","test-web"]);function q(e){let t=!1;for(let n=e.configs.length-1;n>=0;n--)if(je.has(e.configs[n])){t=!0;break}return t}import{existsSync as X}from"node:fs";import{mkdir as ve,open as Fe,writeFile as Te}from"node:fs/promises";var G={"editor.codeActionsOnSave":{"source.fixAll.eslint":"explicit"},"eslint.experimental.useFlatConfig":!0,"eslint.rules.customizations":[{rule:"style/*",severity:"off"},{rule:"format/*",severity:"off"},{rule:"*-indent",severity:"off"},{rule:"*-spacing",severity:"off"},{rule:"*-spaces",severity:"off"},{rule:"*-order",severity:"off"},{rule:"*-dangle",severity:"off"},{rule:"*-newline",severity:"off"},{rule:"*quotes",severity:"off"},{rule:"*semi",severity:"off"}],"eslint.validate":["javascript","javascriptreact","typescript","typescriptreact","vue","html","markdown","json","jsonc","yaml","toml","astro"]},$e=Object.keys(G);async function M(){let e=`${p}/.vscode`,t=`${e}/settings.json`;X(e)||await ve(e),X(t)||await Te(t,JSON.stringify(G),"utf8");let n=await Fe(t,"r+"),r=JSON.parse((await n.readFile()).toString()),s=!0;for(let i of $e)if(r[i]){s=!1;break}s&&await n.writeFile(JSON.stringify(Object.assign(r,G))),await n.close()}import Ae from"ora";import*as g from"yoctocolors";var W=[g.yellow("Fetching configs..."),g.cyan("Applying plugins..."),g.blueBright("Parsing profiles...")],Y=["yellow","cyan","blue"];function*V(){let e=Date.now(),t=Ae(W[0]);t.color=Y[0],t.start(),yield;let n=W.length,r;for(r=1;r<n;r++)t.succeed(),t.color=Y[r],t.text=W[r],t.start(),yield;t.color="green",t.text=g.greenBright(`Ready to lint after ${Date.now()-e}ms!`),t.succeed()}var Z={configs:["base"],ignoreFiles:[".eslintignore, .gitignore"],patchVSCode:!0,prettier:!0,rename:{"@typescript-eslint":"ts","@microsoft/sdl":"sdl"}};async function Ee(e){let t=Object.assign({},Z,e);if(t.rename=Object.assign({},Z.rename,e.rename??{}),!t.configs.length)return[];let n=V();n.next();let r=q(t),s=[R(t),L()];if(r&&t.prettier&&s.push(C()),t.ignoreFiles.length)for(let a=t.ignoreFiles.length-1;a>=0;a--)s.push(O(t.ignoreFiles[a]));t.patchVSCode&&s.push(M());let i=await Promise.all(s);n.next();let o=i.shift();o.unshift(y(o.shift(),...c(i))),n.next();let l=E(t,o,r);return n.next(),l}export{Ee as default,d as merge,u as mergeArr};
